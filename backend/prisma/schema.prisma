generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      String                   @id @default(cuid())
  email                   String                   @unique
  password                String
  role                    UserRole                 @default(MEMBER)
  createdAt               DateTime                 @default(now()) @map("created_at")
  firstName               String                   @map("first_name")
  lastName                String                   @map("last_name")
  phone                   String?                  @unique @map("phone_number")
  updatedAt               DateTime                 @updatedAt @map("updated_at")
  status                  UserStatus               @default(ACTIVE)
  member                  Member?
  notificationPreferences NotificationPreference[]
  notifications           notifications[]
  staff                   Staff?
  trainer                 Trainer?
  userSetting             UserSetting?

  @@index([email])
  @@index([role])
  @@map("users")
}

model MembershipPlan {
  id                       String                     @id @default(cuid())
  name                     String
  description              String?
  price                    Float
  duration                 Int
  createdAt                DateTime                   @default(now()) @map("created_at")
  updatedAt                DateTime                   @updatedAt @map("updated_at")
  accessToEquipment        Boolean                    @default(true) @map("access_to_equipment")
  accessToLocker           Boolean                    @default(false) @map("access_to_locker")
  nutritionConsultation    Boolean                    @default(false) @map("nutrition_consultation")
  personalTrainingHours    Float                      @default(0) @map("personal_training_hours")
  unlimitedClasses         Boolean                    @default(false) @map("unlimited_classes")
  membership_plan_features membership_plan_features[]
  subscriptions            Subscription[]

  @@index([name])
  @@map("membership_plans")
}

model Subscription {
  id               String             @id @default(cuid())
  status           SubscriptionStatus @default(ACTIVE)
  autoRenew        Boolean            @default(true) @map("auto_renew")
  createdAt        DateTime           @default(now()) @map("created_at")
  endDate          DateTime           @map("end_date")
  memberId         String             @map("member_id")
  membershipPlanId String             @map("membership_plan_id")
  renewalDate      DateTime?          @map("renewal_date")
  startDate        DateTime           @default(now()) @map("start_date")
  updatedAt        DateTime           @updatedAt @map("updated_at")
  discount_amount  Float              @default(0)
  discount_code_id String?
  final_price      Float              @default(0)
  original_price   Float              @default(0)
  discount_codes   discount_codes?    @relation(fields: [discount_code_id], references: [id])
  member           Member             @relation(fields: [memberId], references: [id], onDelete: Cascade)
  membershipPlan   MembershipPlan     @relation(fields: [membershipPlanId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([membershipPlanId])
  @@index([status])
  @@index([discount_code_id])
  @@map("subscriptions")
}

model Member {
  id               String           @id @default(cuid())
  gender           String?
  height           Float?
  createdAt        DateTime         @default(now()) @map("created_at")
  currentWeight    Float?           @map("current_weight")
  dateOfBirth      DateTime?        @map("date_of_birth")
  emergencyContact String?          @map("emergency_contact")
  targetWeight     Float?           @map("target_weight")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  userId           String           @unique @map("user_id")
  attendance       Attendance[]
  classBookings    ClassBooking[]
  waitlistEntries  ClassWaitlist[]
  invoices         Invoice[]
  waivers          MemberWaiver[]
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments         Payment[]
  subscriptions    Subscription[]
  trainerSessions  TrainerSession[]
  progress         UserProgress[]
  workoutPlans     WorkoutPlan[]

  @@index([userId])
  @@map("members")
}

model Trainer {
  id             String           @id @default(cuid())
  specialization String
  certification  String?
  experience     Int
  bio            String?
  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")
  userId         String           @unique @map("user_id")
  hourlyRate     Float            @map("hourly_rate")
  classSchedules ClassSchedule[]
  sessions       TrainerSession[]
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutPlans   WorkoutPlan[]

  @@index([userId])
  @@index([specialization])
  @@map("trainers")
}

model Class {
  id          String          @id @default(cuid())
  name        String
  description String?
  category    String
  level       ClassLevel      @default(ALL_LEVELS)
  duration    Int
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  maxCapacity Int             @map("max_capacity")
  schedules   ClassSchedule[]

  @@index([category])
  @@index([level])
  @@map("classes")
}

model ClassSchedule {
  id         String          @id @default(cuid())
  createdAt  DateTime        @default(now()) @map("created_at")
  updatedAt  DateTime        @updatedAt @map("updated_at")
  classId    String          @map("class_id")
  daysOfWeek String          @map("days_of_week")
  endTime    DateTime        @map("end_time")
  isActive   Boolean         @default(true) @map("is_active")
  startTime  DateTime        @map("start_time")
  trainerId  String          @map("trainer_id")
  bookings   ClassBooking[]
  class      Class           @relation(fields: [classId], references: [id], onDelete: Cascade)
  trainer    Trainer         @relation(fields: [trainerId], references: [id])
  waitlist   ClassWaitlist[]

  @@index([classId])
  @@index([trainerId])
  @@index([startTime])
  @@map("class_schedules")
}

model ClassBooking {
  id              String        @id @default(cuid())
  status          BookingStatus @default(CONFIRMED)
  bookedAt        DateTime      @default(now()) @map("booked_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  checkedInAt     DateTime?     @map("checked_in_at")
  classScheduleId String        @map("class_schedule_id")
  memberId        String        @map("member_id")
  classSchedule   ClassSchedule @relation(fields: [classScheduleId], references: [id], onDelete: Cascade)
  member          Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([memberId, classScheduleId])
  @@index([memberId])
  @@index([classScheduleId])
  @@index([status])
  @@map("class_bookings")
}

model ClassWaitlist {
  id              String        @id @default(cuid())
  memberId        String        @map("member_id")
  classScheduleId String        @map("class_schedule_id")
  position        Int
  status          String        @default("waiting")
  notifiedAt      DateTime?     @map("notified_at")
  expiresAt       DateTime?     @map("expires_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  classSchedule   ClassSchedule @relation(fields: [classScheduleId], references: [id], onDelete: Cascade)
  member          Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([memberId, classScheduleId])
  @@index([classScheduleId])
  @@index([status])
  @@map("class_waitlist")
}

model TrainerSession {
  id          String        @id @default(cuid())
  status      SessionStatus @default(SCHEDULED)
  title       String
  description String?
  duration    Int
  notes       String?
  rate        Float
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  memberId    String        @map("member_id")
  sessionDate DateTime      @map("session_date")
  trainerId   String        @map("trainer_id")
  member      Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)
  trainer     Trainer       @relation(fields: [trainerId], references: [id])

  @@index([memberId])
  @@index([trainerId])
  @@index([status])
  @@index([sessionDate])
  @@map("trainer_sessions")
}

model WorkoutPlan {
  id            String   @id @default(cuid())
  name          String
  description   String?
  goal          String
  exercises     String
  createdAt     DateTime @default(now()) @map("created_at")
  endDate       DateTime @map("end_date")
  isActive      Boolean  @default(true) @map("is_active")
  startDate     DateTime @default(now()) @map("start_date")
  updatedAt     DateTime @updatedAt @map("updated_at")
  memberId      String   @map("member_id")
  nutritionTips String?  @map("nutrition_tips")
  trainerId     String   @map("trainer_id")
  member        Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  trainer       Trainer  @relation(fields: [trainerId], references: [id])

  @@index([memberId])
  @@index([trainerId])
  @@index([isActive])
  @@map("workout_plans")
}

model UserProgress {
  id              String   @id @default(cuid())
  weight          Float?   @map("weight")
  bmi             Float?
  squat           Float?
  recordedAt      DateTime @default(now()) @map("recorded_at")
  benchPress      Float?   @map("bench_press")
  bodyFat         Float?   @map("body_fat")
  cardioEndurance String?  @map("cardio_endurance")
  deadlift        Float?   @map("dead_lift")
  memberId        String   @map("member_id")
  muscleMass      Float?   @map("muscle_mass")
  member          Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([recordedAt])
  @@map("user_progress")
}

model Attendance {
  id           String         @id @default(cuid())
  type         AttendanceType @default(GYM_VISIT)
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  checkInTime  DateTime       @default(now()) @map("check_in_time")
  checkOutTime DateTime?      @map("check_out_time")
  memberId     String         @map("member_id")
  member       Member         @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([checkInTime])
  @@map("attendance")
}

model Equipment {
  id                  String    @id @default(cuid())
  name                String
  category            String
  description         String?
  quantity            Int       @default(1)
  lastMaintenanceDate DateTime? @map("last_maintenance_date")
  nextMaintenanceDate DateTime? @map("next_maintenance_date")
  maintenanceInterval Int?      @map("maintenance_interval")
  isActive            Boolean   @default(true)
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  @@index([category])
  @@index([isActive])
  @@map("equipments")
}

model Payment {
  id             String        @id @default(cuid())
  memberId       String        @map("member_id")
  invoiceId      String?       @map("invoice_id")
  amount         Float
  paymentMethod  PaymentMethod @map("payment_method")
  status         PaymentStatus @default(PENDING)
  transactionRef String?       @unique @map("transaction_ref")
  description    String?
  paidAt         DateTime?     @map("paid_at")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  invoice        Invoice?      @relation(fields: [invoiceId], references: [id])
  member         Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([status])
  @@index([paidAt])
  @@map("payments")
}

model Invoice {
  id            String        @id @default(cuid())
  memberId      String        @map("member_id")
  invoiceNumber String        @unique @map("invoice_number")
  status        InvoiceStatus @default(DRAFT)
  subtotal      Float
  tax           Float         @default(0)
  discount      Float         @default(0)
  total         Float
  dueDate       DateTime      @map("due_date")
  paidAt        DateTime?     @map("paid_at")
  notes         String?
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  items         InvoiceItem[]
  member        Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)
  payments      Payment[]

  @@index([memberId])
  @@index([status])
  @@index([dueDate])
  @@map("invoices")
}

model InvoiceItem {
  id          String  @id @default(cuid())
  invoiceId   String  @map("invoice_id")
  description String
  quantity    Int     @default(1)
  unitPrice   Float   @map("unit_price")
  total       Float
  itemType    String  @map("item_type")
  itemId      String? @map("item_id")
  invoice     Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_items")
}

model Discount {
  id              String   @id @default(cuid())
  code            String   @unique
  name            String
  description     String?
  type            String
  value           Float
  minPurchase     Float?   @map("min_purchase")
  maxUses         Int?     @map("max_uses")
  usedCount       Int      @default(0) @map("used_count")
  validFrom       DateTime @map("valid_from")
  validUntil      DateTime @map("valid_until")
  isActive        Boolean  @default(true) @map("is_active")
  applicablePlans String?  @map("applicable_plans")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@index([code])
  @@index([isActive])
  @@map("discounts")
}

model Staff {
  id               String       @id @default(cuid())
  userId           String       @unique @map("user_id")
  staffRole        StaffRole    @map("staff_role")
  employeeId       String       @unique @map("employee_id")
  hireDate         DateTime     @map("hire_date")
  department       String?
  position         String
  emergencyContact String?      @map("emergency_contact")
  address          String?
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  shifts           StaffShift[]

  @@index([staffRole])
  @@index([department])
  @@map("staff")
}

model StaffShift {
  id             String      @id @default(cuid())
  staffId        String      @map("staff_id")
  status         ShiftStatus @default(SCHEDULED)
  scheduledStart DateTime    @map("scheduled_start")
  scheduledEnd   DateTime    @map("scheduled_end")
  actualStart    DateTime?   @map("actual_start")
  actualEnd      DateTime?   @map("actual_end")
  breakMinutes   Int         @default(0) @map("break_minutes")
  notes          String?
  createdAt      DateTime    @default(now()) @map("created_at")
  updatedAt      DateTime    @updatedAt @map("updated_at")
  staff          Staff       @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([scheduledStart])
  @@index([status])
  @@map("staff_shifts")
}

model WaiverTemplate {
  id          String         @id @default(cuid())
  name        String
  description String?
  content     String
  version     Int            @default(1)
  isActive    Boolean        @default(true) @map("is_active")
  isRequired  Boolean        @default(true) @map("is_required")
  createdAt   DateTime       @default(now()) @map("created_at")
  updatedAt   DateTime       @updatedAt @map("updated_at")
  waivers     MemberWaiver[]

  @@index([isActive])
  @@map("waiver_templates")
}

model MemberWaiver {
  id               String         @id @default(cuid())
  memberId         String         @map("member_id")
  waiverTemplateId String         @map("waiver_template_id")
  signedAt         DateTime       @default(now()) @map("signed_at")
  signatureData    String?        @map("signature_data")
  ipAddress        String?        @map("ip_address")
  userAgent        String?        @map("user_agent")
  version          Int
  member           Member         @relation(fields: [memberId], references: [id], onDelete: Cascade)
  waiverTemplate   WaiverTemplate @relation(fields: [waiverTemplateId], references: [id])

  @@unique([memberId, waiverTemplateId])
  @@index([memberId])
  @@map("member_waivers")
}

model NotificationPreference {
  id           String               @id @default(cuid())
  userId       String               @map("user_id")
  category     NotificationCategory
  emailEnabled Boolean              @default(true) @map("email_enabled")
  smsEnabled   Boolean              @default(false) @map("sms_enabled")
  pushEnabled  Boolean              @default(true) @map("push_enabled")
  inAppEnabled Boolean              @default(true) @map("in_app_enabled")
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  user         User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category])
  @@map("notification_preferences")
}

model NotificationTemplate {
  id        String               @id @default(cuid())
  name      String               @unique
  type      NotificationType
  category  NotificationCategory @default(ANNOUNCEMENT)
  subject   String?
  body      String
  isActive  Boolean              @default(true) @map("is_active")
  createdAt DateTime             @default(now()) @map("created_at")
  updatedAt DateTime             @updatedAt @map("updated_at")

  @@index([type])
  @@index([category])
  @@map("notification_templates")
}

model NotificationLog {
  id         String               @id @default(cuid())
  userId     String               @map("user_id")
  type       NotificationType
  category   NotificationCategory @default(ANNOUNCEMENT)
  subject    String?
  content    String
  status     String               @default("pending")
  sentAt     DateTime?            @map("sent_at")
  readAt     DateTime?            @map("read_at")
  failReason String?              @map("fail_reason")
  metadata   String?
  createdAt  DateTime             @default(now()) @map("created_at")

  @@index([userId])
  @@index([type])
  @@index([category])
  @@index([status])
  @@index([sentAt])
  @@map("notification_logs")
}

model PushSubscription {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  endpoint   String   @unique
  p256dh     String
  auth       String
  deviceType String?  @map("device_type")
  deviceName String?  @map("device_name")
  isActive   Boolean  @default(true) @map("is_active")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@index([isActive])
  @@map("push_subscriptions")
}

model GymSetting {
  id                         String   @id @default(cuid())
  name                       String   @unique @default("My Gym") @map("gym_name")
  tagLine                    String   @default("") @map("tag_line")
  address                    String   @default("")
  phone                      String   @unique @default("")
  email                      String   @unique @default("")
  logo                       String   @default("")
  description                String   @default("")
  favicon                    String   @default("")
  emailNotification          Boolean  @default(true) @map("email_notification")
  smsNotification            Boolean  @default(true) @map("sms_notification")
  createdAt                  DateTime @default(now()) @map("created_at")
  updatedAt                  DateTime @updatedAt @map("updated_at")
  newAttendanceNotification  Boolean  @default(true) @map("new_attendance_notification")
  newEquipmentNotification   Boolean  @default(true) @map("new_equipment_notification")
  newGymSettingNotification  Boolean  @default(true) @map("new_gym_setting_notification")
  newMemberNotification      Boolean  @default(true) @map("new_member_notification")
  newMembershipNotification  Boolean  @default(true) @map("new_membership_notification")
  newPaymentNotification     Boolean  @default(true) @map("new_payment_notification")
  newProgressNotification    Boolean  @default(true) @map("new_progress_notification")
  newSessionNotification     Boolean  @default(true) @map("new_session_notification")
  newTrainerNotification     Boolean  @default(true) @map("new_trainer_notification")
  newUserSettingNotification Boolean  @default(true) @map("new_user_setting_notification")
  newWorkoutPlanNotification Boolean  @default(true) @map("new_workout_plan_notification")

  @@map("gym_settings")
}

model UserSetting {
  id           String   @id @default(cuid())
  userId       String   @unique @map("user_id")
  language     String   @default("en")
  theme        String   @default("system")
  notification Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_settings")
}

model discount_codes {
  id              String         @id
  code            String         @unique
  description     String?
  type            DiscountType
  amount          Float
  is_active       Boolean        @default(true)
  max_redemptions Int?
  used_count      Int            @default(0)
  starts_at       DateTime?
  ends_at         DateTime?
  created_at      DateTime       @default(now())
  updated_at      DateTime
  subscriptions   Subscription[]

  @@index([code])
  @@index([is_active])
}

model features {
  id                       String                     @id
  name                     String                     @unique
  description              String?
  is_system                Boolean                    @default(false)
  default_name             String?
  created_at               DateTime                   @default(now())
  updated_at               DateTime
  membership_plan_features membership_plan_features[]

  @@index([name])
}

model gym_closures {
  id         String   @id
  date       DateTime
  reason     String   @default("")
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([date])
}

model gym_operating_hours {
  id          String   @id
  day_of_week Int      @unique
  open_time   String
  close_time  String
  is_closed   Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime
}

model membership_plan_features {
  id                 String         @id
  membership_plan_id String
  feature_id         String
  level              FeatureLevel   @default(BASIC)
  created_at         DateTime       @default(now())
  updated_at         DateTime
  features           features       @relation(fields: [feature_id], references: [id], onDelete: Cascade)
  membership_plans   MembershipPlan @relation(fields: [membership_plan_id], references: [id], onDelete: Cascade)

  @@unique([membership_plan_id, feature_id])
  @@index([feature_id])
  @@index([membership_plan_id])
}

model notifications {
  id         String    @id
  user_id    String?
  role       UserRole?
  title      String
  message    String
  type       String    @default("info")
  read       Boolean   @default(false)
  action_url String?
  created_at DateTime  @default(now())
  updated_at DateTime
  users      User?     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([read])
  @@index([role])
  @@index([user_id])
}

enum UserRole {
  ADMIN
  TRAINER
  MEMBER
  STAFF
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  PENDING
  FROZEN
}

enum ClassLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  ALL_LEVELS
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
  WAITLISTED
}

enum SessionStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum AttendanceType {
  GYM_VISIT
  CLASS_ATTENDANCE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  CANCELLED
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  DEBIT_CARD
  BANK_TRANSFER
  MOBILE_PAYMENT
  OTHER
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

enum StaffRole {
  MANAGER
  RECEPTIONIST
  MAINTENANCE
  CLEANING
  SECURITY
}

enum ShiftStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NotificationType {
  EMAIL
  SMS
  PUSH
  IN_APP
}

enum NotificationCategory {
  BILLING
  MARKETING
  CLASS_REMINDER
  PT_SESSION
  ACCOUNT_ACTIVITY
  ANNOUNCEMENT
  WORKOUT_PROGRESS
  ATTENDANCE
}

enum DiscountType {
  PERCENTAGE
  FIXED
}

enum FeatureLevel {
  BASIC
  STANDARD
  PREMIUM
}

enum UserStatus {
  ACTIVE
  INACTIVE
}
