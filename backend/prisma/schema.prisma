generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

model User {
    id                        String                   @id @default(cuid())
    email                     String                   @unique
    password                  String
    role                      UserRole                 @default(MEMBER)
    createdAt                 DateTime                 @default(now()) @map("created_at")
    firstName                 String                   @map("first_name")
    lastName                  String                   @map("last_name")
    phone                     String?                  @unique @map("phone_number")
    address                   String?                  @default("") @map("address")
    avatarUrl                 String?                  @default("") @map("avatar_url")
    updatedAt                 DateTime                 @updatedAt @map("updated_at")
    status                    UserStatus               @default(ACTIVE)
    member                    Member?
    notificationPreferences   NotificationPreference[]
    notifications             Notification[]
    staff                     Staff?
    trainer                   Trainer?
    userSetting               UserSetting?
    assignedRetentionTasks    RetentionTask[]
    retentionTaskChanges      RetentionTaskHistory[]
    createdMarketingCampaigns MarketingCampaign[]
    campaignRecipients        CampaignRecipient[]
    posSales                  ProductSale[]            @relation("SaleProcessedBy")
    inventoryAdjustments      InventoryStockMovement[] @relation("InventoryAdjustedBy")

    @@index([email])
    @@index([role])
    @@map("users")
}

model MembershipPlan {
    id                     String                  @id @default(cuid())
    name                   String
    description            String?
    price                  Float
    duration               Int
    createdAt              DateTime                @default(now()) @map("created_at")
    updatedAt              DateTime                @updatedAt @map("updated_at")
    accessToEquipment      Boolean                 @default(true) @map("access_to_equipment")
    accessToLocker         Boolean                 @default(false) @map("access_to_locker")
    nutritionConsultation  Boolean                 @default(false) @map("nutrition_consultation")
    personalTrainingHours  Float                   @default(0) @map("personal_training_hours")
    unlimitedClasses       Boolean                 @default(false) @map("unlimited_classes")
    membershipPlanFeatures MembershipPlanFeature[]
    subscriptions          Subscription[]

    @@index([name])
    @@map("membership_plans")
}

model Subscription {
    id               String             @id @default(cuid())
    status           SubscriptionStatus @default(ACTIVE)
    autoRenew        Boolean            @default(true) @map("auto_renew")
    createdAt        DateTime           @default(now()) @map("created_at")
    endDate          DateTime           @map("end_date")
    memberId         String             @map("member_id")
    membershipPlanId String             @map("membership_plan_id")
    renewalDate      DateTime?          @map("renewal_date")
    startDate        DateTime           @default(now()) @map("start_date")
    updatedAt        DateTime           @updatedAt @map("updated_at")
    discountAmount   Float              @default(0) @map("discount_amount")
    discountCodeId   String?            @map("discount_code_id")
    finalPrice       Float              @default(0) @map("final_price")
    originalPrice    Float              @default(0) @map("original_price")
    discountCode     DiscountCode?      @relation(fields: [discountCodeId], references: [id])
    member           Member             @relation(fields: [memberId], references: [id], onDelete: Cascade)
    membershipPlan   MembershipPlan     @relation(fields: [membershipPlanId], references: [id], onDelete: Cascade)
    payments         Payment[]

    @@index([memberId])
    @@index([membershipPlanId])
    @@index([status])
    @@index([discountCodeId])
    @@map("subscriptions")
}

model Payment {
    id             String            @id @default(cuid())
    memberId       String            @map("member_id")
    invoiceId      String?           @map("invoice_id")
    subscriptionId String?           @map("subscription_id")
    amount         Float
    currency       String            @default("MMK")
    methodType     PaymentMethodType @map("method_type")
    provider       PaymentProvider
    transactionNo  String            @map("transaction_no")
    screenshotUrl  String?           @map("screenshot_url")
    status         PaymentStatus     @default(PENDING)
    adminNote      String?           @map("admin_note")
    paidAt         DateTime?         @map("paid_at")
    createdAt      DateTime          @default(now()) @map("created_at")
    updatedAt      DateTime          @updatedAt @map("updated_at")
    member         Member            @relation(fields: [memberId], references: [id], onDelete: Cascade)
    invoice        Invoice?          @relation(fields: [invoiceId], references: [id])
    subscription   Subscription?     @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)

    @@index([memberId])
    @@index([invoiceId])
    @@index([subscriptionId])
    @@index([status])
    @@index([provider])
    @@map("payments")
}

model Member {
    id                      String                   @id @default(cuid())
    gender                  String?
    height                  Float?
    createdAt               DateTime                 @default(now()) @map("created_at")
    currentWeight           Float?                   @map("current_weight")
    dateOfBirth             DateTime?                @map("date_of_birth")
    emergencyContact        String?                  @map("emergency_contact")
    targetWeight            Float?                   @map("target_weight")
    updatedAt               DateTime                 @updatedAt @map("updated_at")
    userId                  String                   @unique @map("user_id")
    qrCodeToken             String?                  @unique @map("qr_code_token")
    qrCodeGeneratedAt       DateTime?                @map("qr_code_generated_at")
    attendance              Attendance[]
    classBookings           ClassBooking[]
    waitlistEntries         ClassWaitlist[]
    classFavorites          ClassFavorite[]
    instructorRatings       InstructorRating[]
    classPasses             MemberClassPass[]
    classCreditTransactions ClassCreditTransaction[]
    invoices                Invoice[]
    waivers                 MemberWaiver[]
    user                    User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
    payments                Payment[]
    subscriptions           Subscription[]
    trainerSessions         TrainerSession[]
    progress                UserProgress[]
    progressPhotos          ProgressPhoto[]
    progressGoals           ProgressGoal[]
    progressMilestones      ProgressMilestone[]
    workoutPlans            WorkoutPlan[]
    retentionRisk           MemberRetentionRisk?
    retentionTasks          RetentionTask[]
    productSales            ProductSale[]

    @@index([userId])
    @@map("members")
}

model MemberRetentionRisk {
    id                 String             @id @default(cuid())
    memberId           String             @unique @map("member_id")
    riskLevel          RetentionRiskLevel @default(LOW) @map("risk_level")
    score              Int                @default(0)
    reasons            String[]
    lastCheckInAt      DateTime?          @map("last_check_in_at")
    daysSinceCheckIn   Int?               @map("days_since_check_in")
    subscriptionEndsAt DateTime?          @map("subscription_ends_at")
    unpaidPendingCount Int                @default(0) @map("unpaid_pending_count")
    lastEvaluatedAt    DateTime           @default(now()) @map("last_evaluated_at")
    createdAt          DateTime           @default(now()) @map("created_at")
    updatedAt          DateTime           @updatedAt @map("updated_at")
    member             Member             @relation(fields: [memberId], references: [id], onDelete: Cascade)

    @@index([riskLevel])
    @@index([score])
    @@index([lastEvaluatedAt])
    @@map("member_retention_risks")
}

model RetentionTask {
    id           String                 @id @default(cuid())
    memberId     String                 @map("member_id")
    assignedToId String?                @map("assigned_to_user_id")
    status       RetentionTaskStatus    @default(OPEN)
    priority     Int                    @default(2)
    title        String
    note         String?
    dueDate      DateTime?              @map("due_date")
    resolvedAt   DateTime?              @map("resolved_at")
    createdAt    DateTime               @default(now()) @map("created_at")
    updatedAt    DateTime               @updatedAt @map("updated_at")
    member       Member                 @relation(fields: [memberId], references: [id], onDelete: Cascade)
    assignedTo   User?                  @relation(fields: [assignedToId], references: [id])
    history      RetentionTaskHistory[]

    @@index([memberId])
    @@index([assignedToId])
    @@index([status])
    @@index([dueDate])
    @@map("retention_tasks")
}

model RetentionTaskHistory {
    id               String               @id @default(cuid())
    taskId           String               @map("task_id")
    changedByUserId  String?              @map("changed_by_user_id")
    fromStatus       RetentionTaskStatus? @map("from_status")
    toStatus         RetentionTaskStatus? @map("to_status")
    fromPriority     Int?                 @map("from_priority")
    toPriority       Int?                 @map("to_priority")
    fromAssignedToId String?              @map("from_assigned_to_user_id")
    toAssignedToId   String?              @map("to_assigned_to_user_id")
    fromNote         String?              @map("from_note")
    toNote           String?              @map("to_note")
    fromDueDate      DateTime?            @map("from_due_date")
    toDueDate        DateTime?            @map("to_due_date")
    createdAt        DateTime             @default(now()) @map("created_at")
    task             RetentionTask        @relation(fields: [taskId], references: [id], onDelete: Cascade)
    changedByUser    User?                @relation(fields: [changedByUserId], references: [id])

    @@index([taskId])
    @@index([changedByUserId])
    @@index([createdAt])
    @@map("retention_task_history")
}

model Trainer {
    id                String             @id @default(cuid())
    specialization    String
    certification     String?
    experience        Int
    bio               String?
    createdAt         DateTime           @default(now()) @map("created_at")
    updatedAt         DateTime           @updatedAt @map("updated_at")
    userId            String             @unique @map("user_id")
    hourlyRate        Float              @map("hourly_rate")
    classSchedules    ClassSchedule[]
    sessions          TrainerSession[]
    user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
    workoutPlans      WorkoutPlan[]
    instructorRatings InstructorRating[]

    @@index([userId])
    @@index([specialization])
    @@map("trainers")
}

model Class {
    id                   String                @id @default(cuid())
    name                 String
    description          String?
    category             String
    level                ClassLevel            @default(ALL_LEVELS)
    duration             Int
    createdAt            DateTime              @default(now()) @map("created_at")
    updatedAt            DateTime              @updatedAt @map("updated_at")
    maxCapacity          Int                   @map("max_capacity")
    schedules            ClassSchedule[]
    marketingCampaigns   MarketingCampaign[]
    marketingAutomations MarketingAutomation[]
    favorites            ClassFavorite[]
    classPackages        ClassPackage[]

    @@index([category])
    @@index([level])
    @@map("classes")
}

model ClassSchedule {
    id         String             @id @default(cuid())
    createdAt  DateTime           @default(now()) @map("created_at")
    updatedAt  DateTime           @updatedAt @map("updated_at")
    classId    String             @map("class_id")
    daysOfWeek String             @map("days_of_week")
    endTime    DateTime           @map("end_time")
    isActive   Boolean            @default(true) @map("is_active")
    startTime  DateTime           @map("start_time")
    trainerId  String             @map("trainer_id")
    bookings   ClassBooking[]
    class      Class              @relation(fields: [classId], references: [id], onDelete: Cascade)
    trainer    Trainer            @relation(fields: [trainerId], references: [id])
    waitlist   ClassWaitlist[]
    ratings    InstructorRating[]

    @@index([classId])
    @@index([trainerId])
    @@index([startTime])
    @@map("class_schedules")
}

model ClassBooking {
    id                 String                   @id @default(cuid())
    status             BookingStatus            @default(CONFIRMED)
    bookedAt           DateTime                 @default(now()) @map("booked_at")
    updatedAt          DateTime                 @updatedAt @map("updated_at")
    checkedInAt        DateTime?                @map("checked_in_at")
    classScheduleId    String                   @map("class_schedule_id")
    memberId           String                   @map("member_id")
    classSchedule      ClassSchedule            @relation(fields: [classScheduleId], references: [id], onDelete: Cascade)
    member             Member                   @relation(fields: [memberId], references: [id], onDelete: Cascade)
    creditTransactions ClassCreditTransaction[]

    @@unique([memberId, classScheduleId])
    @@index([memberId])
    @@index([classScheduleId])
    @@index([status])
    @@map("class_bookings")
}

model ClassWaitlist {
    id              String         @id @default(cuid())
    memberId        String         @map("member_id")
    classScheduleId String         @map("class_schedule_id")
    position        Int
    status          WaitlistStatus @default(WAITING)
    notifiedAt      DateTime?      @map("notified_at")
    expiresAt       DateTime?      @map("expires_at")
    createdAt       DateTime       @default(now()) @map("created_at")
    updatedAt       DateTime       @updatedAt @map("updated_at")
    classSchedule   ClassSchedule  @relation(fields: [classScheduleId], references: [id], onDelete: Cascade)
    member          Member         @relation(fields: [memberId], references: [id], onDelete: Cascade)

    @@unique([memberId, classScheduleId])
    @@index([classScheduleId])
    @@index([status])
    @@map("class_waitlist")
}

model ClassFavorite {
    id        String   @id @default(cuid())
    memberId  String   @map("member_id")
    classId   String   @map("class_id")
    createdAt DateTime @default(now()) @map("created_at")
    class     Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
    member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

    @@unique([memberId, classId])
    @@index([memberId])
    @@index([classId])
    @@map("class_favorites")
}

model InstructorRating {
    id              String        @id @default(cuid())
    memberId        String        @map("member_id")
    trainerId       String        @map("trainer_id")
    classScheduleId String        @map("class_schedule_id")
    rating          Int
    review          String?
    createdAt       DateTime      @default(now()) @map("created_at")
    updatedAt       DateTime      @updatedAt @map("updated_at")
    member          Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)
    trainer         Trainer       @relation(fields: [trainerId], references: [id], onDelete: Cascade)
    classSchedule   ClassSchedule @relation(fields: [classScheduleId], references: [id], onDelete: Cascade)

    @@unique([memberId, classScheduleId])
    @@index([trainerId])
    @@index([classScheduleId])
    @@map("instructor_ratings")
}

model ClassPackage {
    id               String            @id @default(cuid())
    name             String
    description      String?
    passType         ClassPassType     @map("pass_type")
    classId          String?           @map("class_id")
    creditsIncluded  Int               @default(0) @map("credits_included")
    price            Float
    validityDays     Int?              @map("validity_days")
    monthlyUnlimited Boolean           @default(false) @map("monthly_unlimited")
    isActive         Boolean           @default(true) @map("is_active")
    createdAt        DateTime          @default(now()) @map("created_at")
    updatedAt        DateTime          @updatedAt @map("updated_at")
    class            Class?            @relation(fields: [classId], references: [id], onDelete: SetNull)
    memberPasses     MemberClassPass[]

    @@index([passType])
    @@index([classId])
    @@index([isActive])
    @@map("class_packages")
}

model MemberClassPass {
    id                 String                   @id @default(cuid())
    memberId           String                   @map("member_id")
    classPackageId     String                   @map("class_package_id")
    status             PassStatus               @default(ACTIVE)
    purchasedAt        DateTime                 @default(now()) @map("purchased_at")
    expiresAt          DateTime                 @map("expires_at")
    remainingCredits   Int                      @default(0) @map("remaining_credits")
    totalCredits       Int                      @default(0) @map("total_credits")
    monthlyUnlimited   Boolean                  @default(false) @map("monthly_unlimited")
    createdAt          DateTime                 @default(now()) @map("created_at")
    updatedAt          DateTime                 @updatedAt @map("updated_at")
    member             Member                   @relation(fields: [memberId], references: [id], onDelete: Cascade)
    classPackage       ClassPackage             @relation(fields: [classPackageId], references: [id], onDelete: Cascade)
    creditTransactions ClassCreditTransaction[]

    @@index([memberId])
    @@index([classPackageId])
    @@index([status])
    @@index([expiresAt])
    @@map("member_class_passes")
}

model ClassCreditTransaction {
    id                String                @id @default(cuid())
    memberId          String                @map("member_id")
    memberClassPassId String?               @map("member_class_pass_id")
    bookingId         String?               @map("booking_id")
    transactionType   CreditTransactionType @map("transaction_type")
    creditsDelta      Int                   @map("credits_delta")
    balanceAfter      Int                   @map("balance_after")
    notes             String?
    createdAt         DateTime              @default(now()) @map("created_at")
    member            Member                @relation(fields: [memberId], references: [id], onDelete: Cascade)
    memberClassPass   MemberClassPass?      @relation(fields: [memberClassPassId], references: [id], onDelete: SetNull)
    booking           ClassBooking?         @relation(fields: [bookingId], references: [id], onDelete: SetNull)

    @@index([memberId])
    @@index([memberClassPassId])
    @@index([bookingId])
    @@index([transactionType])
    @@map("class_credit_transactions")
}

model TrainerSession {
    id          String        @id @default(cuid())
    status      SessionStatus @default(SCHEDULED)
    title       String
    description String?
    duration    Int
    notes       String?
    rate        Float
    createdAt   DateTime      @default(now()) @map("created_at")
    updatedAt   DateTime      @updatedAt @map("updated_at")
    memberId    String        @map("member_id")
    sessionDate DateTime      @map("session_date")
    trainerId   String        @map("trainer_id")
    member      Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)
    trainer     Trainer       @relation(fields: [trainerId], references: [id])

    @@index([memberId])
    @@index([trainerId])
    @@index([status])
    @@index([sessionDate])
    @@map("trainer_sessions")
}

model WorkoutPlan {
    id            String   @id @default(cuid())
    name          String
    description   String?
    goal          String
    exercises     String
    createdAt     DateTime @default(now()) @map("created_at")
    endDate       DateTime @map("end_date")
    isActive      Boolean  @default(true) @map("is_active")
    startDate     DateTime @default(now()) @map("start_date")
    updatedAt     DateTime @updatedAt @map("updated_at")
    memberId      String   @map("member_id")
    nutritionTips String?  @map("nutrition_tips")
    trainerId     String   @map("trainer_id")
    member        Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
    trainer       Trainer  @relation(fields: [trainerId], references: [id])

    @@index([memberId])
    @@index([trainerId])
    @@index([isActive])
    @@map("workout_plans")
}

model UserProgress {
    id              String   @id @default(cuid())
    weight          Float?   @map("weight")
    bmi             Float?
    squat           Float?
    recordedAt      DateTime @default(now()) @map("recorded_at")
    benchPress      Float?   @map("bench_press")
    bodyFat         Float?   @map("body_fat")
    cardioEndurance String?  @map("cardio_endurance")
    deadlift        Float?   @map("dead_lift")
    notes           String?
    neck            Float?
    chest           Float?
    waist           Float?
    hips            Float?
    leftArm         Float?   @map("left_arm")
    rightArm        Float?   @map("right_arm")
    leftThigh       Float?   @map("left_thigh")
    rightThigh      Float?   @map("right_thigh")
    leftCalf        Float?   @map("left_calf")
    rightCalf       Float?   @map("right_calf")
    memberId        String   @map("member_id")
    muscleMass      Float?   @map("muscle_mass")
    member          Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

    @@index([memberId])
    @@index([recordedAt])
    @@map("user_progress")
}

model ProgressPhoto {
    id         String             @id @default(cuid())
    memberId   String             @map("member_id")
    photoUrl   String             @map("photo_url")
    pose       ProgressPhotoPose  @default(FRONT)
    phase      ProgressPhotoPhase @default(PROGRESS)
    capturedAt DateTime           @default(now()) @map("captured_at")
    note       String?
    createdAt  DateTime           @default(now()) @map("created_at")
    updatedAt  DateTime           @updatedAt @map("updated_at")
    member     Member             @relation(fields: [memberId], references: [id], onDelete: Cascade)

    @@index([memberId])
    @@index([capturedAt])
    @@index([phase])
    @@map("progress_photos")
}

model ProgressGoal {
    id           String              @id @default(cuid())
    memberId     String              @map("member_id")
    type         ProgressGoalType
    metric       ProgressMetric
    title        String
    description  String?
    unit         String?
    startValue   Float               @map("start_value")
    targetValue  Float               @map("target_value")
    currentValue Float               @map("current_value")
    status       ProgressGoalStatus  @default(ACTIVE)
    startDate    DateTime            @default(now()) @map("start_date")
    targetDate   DateTime?           @map("target_date")
    achievedAt   DateTime?           @map("achieved_at")
    createdAt    DateTime            @default(now()) @map("created_at")
    updatedAt    DateTime            @updatedAt @map("updated_at")
    member       Member              @relation(fields: [memberId], references: [id], onDelete: Cascade)
    milestones   ProgressMilestone[]

    @@index([memberId])
    @@index([status])
    @@index([targetDate])
    @@map("progress_goals")
}

model ProgressMilestone {
    id           String        @id @default(cuid())
    memberId     String        @map("member_id")
    goalId       String?       @map("goal_id")
    title        String
    description  String?
    reachedValue Float?        @map("reached_value")
    unit         String?
    shareToken   String?       @unique @map("share_token")
    achievedAt   DateTime      @default(now()) @map("achieved_at")
    createdAt    DateTime      @default(now()) @map("created_at")
    updatedAt    DateTime      @updatedAt @map("updated_at")
    member       Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)
    goal         ProgressGoal? @relation(fields: [goalId], references: [id], onDelete: SetNull)

    @@index([memberId])
    @@index([goalId])
    @@index([achievedAt])
    @@map("progress_milestones")
}

model Attendance {
    id           String         @id @default(cuid())
    type         AttendanceType @default(GYM_VISIT)
    createdAt    DateTime       @default(now()) @map("created_at")
    updatedAt    DateTime       @updatedAt @map("updated_at")
    checkInTime  DateTime       @default(now()) @map("check_in_time")
    checkOutTime DateTime?      @map("check_out_time")
    memberId     String         @map("member_id")
    member       Member         @relation(fields: [memberId], references: [id], onDelete: Cascade)

    @@index([memberId])
    @@index([checkInTime])
    @@map("attendance")
}

model Equipment {
    id                   String                    @id @default(cuid())
    name                 String
    category             String
    description          String?
    quantity             Int                       @default(1)
    brandModel           String                    @default("") @map("brand_model")
    serialNumber         String?                   @map("serial_number")
    purchaseDate         DateTime                  @default(now()) @map("purchase_date")
    purchaseCost         Float                     @default(0) @map("purchase_cost")
    warrantyExpiryDate   DateTime                  @default(now()) @map("warranty_expiry_date")
    condition            String                    @default("good")
    maintenanceFrequency String                    @default("monthly") @map("maintenance_frequency")
    lastMaintenanceDate  DateTime                  @default(now()) @map("last_maintenance_date")
    nextMaintenanceDate  DateTime                  @default(now()) @map("next_maintenance_date")
    maintenanceInterval  Int?                      @map("maintenance_interval")
    assignedArea         String                    @default("") @map("assigned_area")
    notes                String                    @default("")
    isActive             Boolean                   @default(true)
    createdAt            DateTime                  @default(now()) @map("created_at")
    updatedAt            DateTime                  @updatedAt @map("updated_at")
    maintenanceLogs      EquipmentMaintenanceLog[]
    auditLogs            EquipmentAuditLog[]

    @@index([category])
    @@index([condition])
    @@index([nextMaintenanceDate])
    @@index([warrantyExpiryDate])
    @@index([isActive])
    @@map("equipments")
}

model EquipmentMaintenanceLog {
    id          String    @id @default(cuid())
    equipmentId String    @map("equipment_id")
    date        DateTime
    type        String
    description String
    cost        Float     @default(0)
    performedBy String    @map("performed_by")
    nextDueDate DateTime? @map("next_due_date")
    createdAt   DateTime  @default(now()) @map("created_at")
    equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

    @@index([equipmentId])
    @@index([date])
    @@map("equipment_maintenance_logs")
}

model EquipmentAuditLog {
    id          String    @id @default(cuid())
    equipmentId String    @map("equipment_id")
    date        DateTime  @default(now())
    action      String
    description String
    performedBy String    @map("performed_by")
    createdAt   DateTime  @default(now()) @map("created_at")
    equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

    @@index([equipmentId])
    @@index([date])
    @@map("equipment_audit_logs")
}

model Product {
    id                String                   @id @default(cuid())
    name              String
    sku               String                   @unique
    category          ProductCategory          @default(OTHER)
    description       String?
    salePrice         Float                    @map("sale_price")
    costPrice         Float?                   @map("cost_price")
    stockQuantity     Int                      @default(0) @map("stock_quantity")
    lowStockThreshold Int                      @default(5) @map("low_stock_threshold")
    isActive          Boolean                  @default(true) @map("is_active")
    createdAt         DateTime                 @default(now()) @map("created_at")
    updatedAt         DateTime                 @updatedAt @map("updated_at")
    saleItems         ProductSaleItem[]
    stockMovements    InventoryStockMovement[]

    @@index([name])
    @@index([sku])
    @@index([category])
    @@index([isActive])
    @@index([stockQuantity])
    @@map("products")
}

model ProductSale {
    id                String            @id @default(cuid())
    saleNumber        String            @unique @map("sale_number")
    memberId          String?           @map("member_id")
    processedByUserId String?           @map("processed_by_user_id")
    paymentMethod     PosPaymentMethod  @default(CASH) @map("payment_method")
    status            ProductSaleStatus @default(COMPLETED)
    subtotal          Float
    discount          Float             @default(0)
    tax               Float             @default(0)
    total             Float
    notes             String?
    soldAt            DateTime          @default(now()) @map("sold_at")
    createdAt         DateTime          @default(now()) @map("created_at")
    updatedAt         DateTime          @updatedAt @map("updated_at")
    items             ProductSaleItem[]
    member            Member?           @relation(fields: [memberId], references: [id], onDelete: SetNull)
    processedBy       User?             @relation("SaleProcessedBy", fields: [processedByUserId], references: [id], onDelete: SetNull)

    @@index([memberId])
    @@index([processedByUserId])
    @@index([soldAt])
    @@index([status])
    @@index([paymentMethod])
    @@map("product_sales")
}

model ProductSaleItem {
    id        String      @id @default(cuid())
    saleId    String      @map("sale_id")
    productId String      @map("product_id")
    quantity  Int
    unitPrice Float       @map("unit_price")
    lineTotal Float       @map("line_total")
    createdAt DateTime    @default(now()) @map("created_at")
    sale      ProductSale @relation(fields: [saleId], references: [id], onDelete: Cascade)
    product   Product     @relation(fields: [productId], references: [id], onDelete: Restrict)

    @@index([saleId])
    @@index([productId])
    @@map("product_sale_items")
}

model InventoryStockMovement {
    id               String            @id @default(cuid())
    productId        String            @map("product_id")
    movementType     StockMovementType @map("movement_type")
    quantityDelta    Int               @map("quantity_delta")
    previousQuantity Int               @map("previous_quantity")
    newQuantity      Int               @map("new_quantity")
    referenceType    String?           @map("reference_type")
    referenceId      String?           @map("reference_id")
    note             String?
    createdByUserId  String?           @map("created_by_user_id")
    createdAt        DateTime          @default(now()) @map("created_at")
    product          Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
    createdBy        User?             @relation("InventoryAdjustedBy", fields: [createdByUserId], references: [id], onDelete: SetNull)

    @@index([productId])
    @@index([movementType])
    @@index([createdByUserId])
    @@index([createdAt])
    @@map("inventory_stock_movements")
}

model Invoice {
    id            String        @id @default(cuid())
    memberId      String        @map("member_id")
    invoiceNumber String        @unique @map("invoice_number")
    status        InvoiceStatus @default(DRAFT)
    subtotal      Float
    tax           Float         @default(0)
    discount      Float         @default(0)
    total         Float
    dueDate       DateTime      @map("due_date")
    paidAt        DateTime?     @map("paid_at")
    notes         String?
    createdAt     DateTime      @default(now()) @map("created_at")
    updatedAt     DateTime      @updatedAt @map("updated_at")
    items         InvoiceItem[]
    member        Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)
    payments      Payment[]

    @@index([memberId])
    @@index([status])
    @@index([dueDate])
    @@map("invoices")
}

model InvoiceItem {
    id          String  @id @default(cuid())
    invoiceId   String  @map("invoice_id")
    description String
    quantity    Int     @default(1)
    unitPrice   Float   @map("unit_price")
    total       Float
    itemType    String  @map("item_type")
    itemId      String? @map("item_id")
    invoice     Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

    @@index([invoiceId])
    @@map("invoice_items")
}

model Staff {
    id               String       @id @default(cuid())
    userId           String       @unique @map("user_id")
    staffRole        StaffRole    @map("staff_role")
    employeeId       String       @unique @map("employee_id")
    hireDate         DateTime     @map("hire_date")
    department       String?
    position         String
    emergencyContact String?      @map("emergency_contact")
    address          String?
    createdAt        DateTime     @default(now()) @map("created_at")
    updatedAt        DateTime     @updatedAt @map("updated_at")
    user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)
    shifts           StaffShift[]

    @@index([staffRole])
    @@index([department])
    @@map("staff")
}

model StaffShift {
    id             String      @id @default(cuid())
    staffId        String      @map("staff_id")
    status         ShiftStatus @default(SCHEDULED)
    scheduledStart DateTime    @map("scheduled_start")
    scheduledEnd   DateTime    @map("scheduled_end")
    actualStart    DateTime?   @map("actual_start")
    actualEnd      DateTime?   @map("actual_end")
    breakMinutes   Int         @default(0) @map("break_minutes")
    notes          String?
    createdAt      DateTime    @default(now()) @map("created_at")
    updatedAt      DateTime    @updatedAt @map("updated_at")
    staff          Staff       @relation(fields: [staffId], references: [id], onDelete: Cascade)

    @@index([staffId])
    @@index([scheduledStart])
    @@index([status])
    @@map("staff_shifts")
}

model WaiverTemplate {
    id          String         @id @default(cuid())
    name        String
    description String?
    content     String
    version     Int            @default(1)
    isActive    Boolean        @default(true) @map("is_active")
    isRequired  Boolean        @default(true) @map("is_required")
    createdAt   DateTime       @default(now()) @map("created_at")
    updatedAt   DateTime       @updatedAt @map("updated_at")
    waivers     MemberWaiver[]

    @@index([isActive])
    @@map("waiver_templates")
}

model MemberWaiver {
    id               String         @id @default(cuid())
    memberId         String         @map("member_id")
    waiverTemplateId String         @map("waiver_template_id")
    signedAt         DateTime       @default(now()) @map("signed_at")
    signatureData    String?        @map("signature_data")
    ipAddress        String?        @map("ip_address")
    userAgent        String?        @map("user_agent")
    version          Int
    member           Member         @relation(fields: [memberId], references: [id], onDelete: Cascade)
    waiverTemplate   WaiverTemplate @relation(fields: [waiverTemplateId], references: [id])

    @@unique([memberId, waiverTemplateId])
    @@index([memberId])
    @@map("member_waivers")
}

model NotificationPreference {
    id           String               @id @default(cuid())
    userId       String               @map("user_id")
    category     NotificationCategory
    emailEnabled Boolean              @default(true) @map("email_enabled")
    smsEnabled   Boolean              @default(false) @map("sms_enabled")
    pushEnabled  Boolean              @default(true) @map("push_enabled")
    inAppEnabled Boolean              @default(true) @map("in_app_enabled")
    createdAt    DateTime             @default(now()) @map("created_at")
    updatedAt    DateTime             @updatedAt @map("updated_at")
    user         User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([userId, category])
    @@map("notification_preferences")
}

model NotificationTemplate {
    id                   String                @id @default(cuid())
    name                 String                @unique
    type                 NotificationType
    category             NotificationCategory  @default(ANNOUNCEMENT)
    subject              String?
    body                 String
    isActive             Boolean               @default(true) @map("is_active")
    createdAt            DateTime              @default(now()) @map("created_at")
    updatedAt            DateTime              @updatedAt @map("updated_at")
    marketingCampaigns   MarketingCampaign[]
    marketingAutomations MarketingAutomation[]

    @@index([type])
    @@index([category])
    @@map("notification_templates")
}

model NotificationLog {
    id         String                @id @default(cuid())
    userId     String                @map("user_id")
    type       NotificationType
    category   NotificationCategory  @default(ANNOUNCEMENT)
    subject    String?
    content    String
    status     NotificationLogStatus @default(PENDING)
    sentAt     DateTime?             @map("sent_at")
    readAt     DateTime?             @map("read_at")
    failReason String?               @map("fail_reason")
    metadata   String?
    createdAt  DateTime              @default(now()) @map("created_at")

    @@index([userId])
    @@index([type])
    @@index([category])
    @@index([status])
    @@index([sentAt])
    @@map("notification_logs")
}

model PushSubscription {
    id         String   @id @default(cuid())
    userId     String   @map("user_id")
    endpoint   String   @unique
    p256dh     String
    auth       String
    deviceType String?  @map("device_type")
    deviceName String?  @map("device_name")
    isActive   Boolean  @default(true) @map("is_active")
    createdAt  DateTime @default(now()) @map("created_at")
    updatedAt  DateTime @updatedAt @map("updated_at")

    @@index([userId])
    @@index([isActive])
    @@map("push_subscriptions")
}

model GymSetting {
    id                         String   @id @default(cuid())
    name                       String   @unique @default("My Gym") @map("gym_name")
    tagLine                    String   @default("") @map("tag_line")
    address                    String   @default("")
    phone                      String   @unique @default("")
    email                      String   @unique @default("")
    logo                       String   @default("")
    description                String   @default("")
    favicon                    String   @default("")
    emailNotification          Boolean  @default(true) @map("email_notification")
    smsNotification            Boolean  @default(true) @map("sms_notification")
    createdAt                  DateTime @default(now()) @map("created_at")
    updatedAt                  DateTime @updatedAt @map("updated_at")
    newAttendanceNotification  Boolean  @default(true) @map("new_attendance_notification")
    newEquipmentNotification   Boolean  @default(true) @map("new_equipment_notification")
    newGymSettingNotification  Boolean  @default(true) @map("new_gym_setting_notification")
    newMemberNotification      Boolean  @default(true) @map("new_member_notification")
    newMembershipNotification  Boolean  @default(true) @map("new_membership_notification")
    newPaymentNotification     Boolean  @default(true) @map("new_payment_notification")
    newProgressNotification    Boolean  @default(true) @map("new_progress_notification")
    newSessionNotification     Boolean  @default(true) @map("new_session_notification")
    newTrainerNotification     Boolean  @default(true) @map("new_trainer_notification")
    newUserSettingNotification Boolean  @default(true) @map("new_user_setting_notification")
    newWorkoutPlanNotification Boolean  @default(true) @map("new_workout_plan_notification")

    @@map("gym_settings")
}

model UserSetting {
    id           String   @id @default(cuid())
    userId       String   @unique @map("user_id")
    language     String   @default("en")
    theme        String   @default("system")
    notification Boolean  @default(true)
    createdAt    DateTime @default(now()) @map("created_at")
    updatedAt    DateTime @updatedAt @map("updated_at")
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@map("user_settings")
}

model DiscountCode {
    id             String         @id @default(cuid())
    code           String         @unique
    description    String?
    type           DiscountType
    amount         Float
    isActive       Boolean        @default(true) @map("is_active")
    maxRedemptions Int?           @map("max_redemptions")
    usedCount      Int            @default(0) @map("used_count")
    startsAt       DateTime?      @map("starts_at")
    endsAt         DateTime?      @map("ends_at")
    createdAt      DateTime       @default(now()) @map("created_at")
    updatedAt      DateTime       @updatedAt @map("updated_at")
    subscriptions  Subscription[]

    @@index([code])
    @@index([isActive])
    @@map("discount_codes")
}

model Feature {
    id                     String                  @id @default(cuid())
    name                   String                  @unique
    description            String?
    isSystem               Boolean                 @default(false) @map("is_system")
    defaultName            String?                 @map("default_name")
    createdAt              DateTime                @default(now()) @map("created_at")
    updatedAt              DateTime                @updatedAt @map("updated_at")
    membershipPlanFeatures MembershipPlanFeature[]

    @@index([name])
    @@map("features")
}

model Pricing {
    id          String          @id @default(cuid())
    name        String
    description String?
    category    PricingCategory
    price       Decimal         @db.Decimal(10, 2)
    currency    String          @default("USD")
    duration    Int?
    features    String[]        @default([])
    isActive    Boolean         @default(true) @map("is_active")
    sortOrder   Int             @default(0) @map("sort_order")
    createdAt   DateTime        @default(now()) @map("created_at")
    updatedAt   DateTime        @updatedAt @map("updated_at")

    @@index([category])
    @@index([isActive])
    @@index([sortOrder])
    @@map("pricing")
}

model GymClosure {
    id        String   @id @default(cuid())
    date      DateTime
    reason    String   @default("")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    @@index([date])
    @@map("gym_closures")
}

model GymOperatingHours {
    id        String   @id @default(cuid())
    dayOfWeek Int      @unique @map("day_of_week")
    openTime  String   @map("open_time")
    closeTime String   @map("close_time")
    isClosed  Boolean  @default(false) @map("is_closed")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    @@map("gym_operating_hours")
}

model MembershipPlanFeature {
    id               String         @id @default(cuid())
    membershipPlanId String         @map("membership_plan_id")
    featureId        String         @map("feature_id")
    level            FeatureLevel   @default(BASIC)
    createdAt        DateTime       @default(now()) @map("created_at")
    updatedAt        DateTime       @updatedAt @map("updated_at")
    feature          Feature        @relation(fields: [featureId], references: [id], onDelete: Cascade)
    membershipPlan   MembershipPlan @relation(fields: [membershipPlanId], references: [id], onDelete: Cascade)

    @@unique([membershipPlanId, featureId])
    @@index([featureId])
    @@index([membershipPlanId])
    @@map("membership_plan_features")
}

model Notification {
    id        String           @id @default(cuid())
    userId    String?          @map("user_id")
    role      UserRole?
    title     String
    message   String
    type      NotificationType @default(IN_APP)
    read      Boolean          @default(false)
    actionUrl String?          @map("action_url")
    createdAt DateTime         @default(now()) @map("created_at")
    updatedAt DateTime         @updatedAt @map("updated_at")
    user      User?            @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([read])
    @@index([role])
    @@index([userId])
    @@map("notifications")
}

model MarketingCampaign {
    id              String                  @id @default(cuid())
    name            String
    description     String?
    type            NotificationType
    category        NotificationCategory    @default(MARKETING)
    status          MarketingCampaignStatus @default(DRAFT)
    audienceType    CampaignAudienceType    @default(ALL_MEMBERS) @map("audience_type")
    customUserIds   String[]                @default([]) @map("custom_user_ids")
    classId         String?                 @map("class_id")
    templateId      String?                 @map("template_id")
    createdByUserId String?                 @map("created_by_user_id")
    subject         String?
    content         String
    specialOffer    String?                 @map("special_offer")
    scheduledAt     DateTime?               @map("scheduled_at")
    sentAt          DateTime?               @map("sent_at")
    createdAt       DateTime                @default(now()) @map("created_at")
    updatedAt       DateTime                @updatedAt @map("updated_at")
    recipients      CampaignRecipient[]
    template        NotificationTemplate?   @relation(fields: [templateId], references: [id], onDelete: SetNull)
    createdByUser   User?                   @relation(fields: [createdByUserId], references: [id], onDelete: SetNull)
    class           Class?                  @relation(fields: [classId], references: [id], onDelete: SetNull)

    @@index([status])
    @@index([audienceType])
    @@index([scheduledAt])
    @@index([classId])
    @@index([templateId])
    @@index([createdByUserId])
    @@map("marketing_campaigns")
}

model CampaignRecipient {
    id          String                  @id @default(cuid())
    campaignId  String                  @map("campaign_id")
    userId      String                  @map("user_id")
    destination String
    type        NotificationType
    status      CampaignRecipientStatus @default(PENDING)
    sentAt      DateTime?               @map("sent_at")
    openedAt    DateTime?               @map("opened_at")
    clickedAt   DateTime?               @map("clicked_at")
    failReason  String?                 @map("fail_reason")
    createdAt   DateTime                @default(now()) @map("created_at")
    updatedAt   DateTime                @updatedAt @map("updated_at")
    campaign    MarketingCampaign       @relation(fields: [campaignId], references: [id], onDelete: Cascade)
    user        User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
    events      CampaignEvent[]

    @@unique([campaignId, userId, type])
    @@index([campaignId])
    @@index([userId])
    @@index([status])
    @@index([sentAt])
    @@map("campaign_recipients")
}

model CampaignEvent {
    id          String            @id @default(cuid())
    recipientId String            @map("recipient_id")
    eventType   CampaignEventType @map("event_type")
    metadata    String?
    createdAt   DateTime          @default(now()) @map("created_at")
    recipient   CampaignRecipient @relation(fields: [recipientId], references: [id], onDelete: Cascade)

    @@index([recipientId])
    @@index([eventType])
    @@index([createdAt])
    @@map("campaign_events")
}

model MarketingAutomation {
    id           String                  @id @default(cuid())
    type         MarketingAutomationType
    name         String
    isActive     Boolean                 @default(true) @map("is_active")
    channel      NotificationType        @default(EMAIL)
    templateId   String?                 @map("template_id")
    subject      String?
    content      String
    specialOffer String?                 @map("special_offer")
    inactiveDays Int                     @default(30) @map("inactive_days")
    classId      String?                 @map("class_id")
    lastRunAt    DateTime?               @map("last_run_at")
    createdAt    DateTime                @default(now()) @map("created_at")
    updatedAt    DateTime                @updatedAt @map("updated_at")
    template     NotificationTemplate?   @relation(fields: [templateId], references: [id], onDelete: SetNull)
    class        Class?                  @relation(fields: [classId], references: [id], onDelete: SetNull)

    @@unique([type, name])
    @@index([type])
    @@index([isActive])
    @@index([classId])
    @@index([templateId])
    @@map("marketing_automations")
}

enum UserRole {
    ADMIN
    TRAINER
    MEMBER
    STAFF
}

enum SubscriptionStatus {
    ACTIVE
    EXPIRED
    CANCELLED
    PENDING
    FROZEN
}

enum ClassLevel {
    BEGINNER
    INTERMEDIATE
    ADVANCED
    ALL_LEVELS
}

enum BookingStatus {
    CONFIRMED
    CANCELLED
    COMPLETED
    NO_SHOW
    WAITLISTED
}

enum SessionStatus {
    SCHEDULED
    COMPLETED
    CANCELLED
    RESCHEDULED
}

enum ProgressPhotoPose {
    FRONT
    SIDE
    BACK
    FLEXED
    OTHER
}

enum ProgressPhotoPhase {
    BEFORE
    AFTER
    PROGRESS
}

enum ProgressGoalType {
    WEIGHT
    STRENGTH
    BODY_COMPOSITION
    MEASUREMENT
}

enum ProgressMetric {
    WEIGHT
    BMI
    BODY_FAT
    MUSCLE_MASS
    CHEST
    WAIST
    HIPS
    LEFT_ARM
    RIGHT_ARM
    LEFT_THIGH
    RIGHT_THIGH
    LEFT_CALF
    RIGHT_CALF
    BENCH_PRESS
    SQUAT
    DEADLIFT
    CUSTOM
}

enum ProgressGoalStatus {
    ACTIVE
    ACHIEVED
    PAUSED
    CANCELLED
}

enum AttendanceType {
    GYM_VISIT
    CLASS_ATTENDANCE
}

enum PaymentStatus {
    PENDING
    PAID
    REJECTED
}

enum PaymentMethodType {
    BANK
    WALLET
}

enum PaymentProvider {
    AYA
    KBZ
    CB
    UAB
    A_BANK
    YOMA
    KBZ_PAY
    AYA_PAY
    CB_PAY
    UAB_PAY
    WAVE_MONEY
}

enum ProductCategory {
    SUPPLEMENT
    MERCHANDISE
    PROTEIN_SHAKE
    OTHER
}

enum PosPaymentMethod {
    CASH
    CARD
    KBZ_PAY
    AYA_PAY
    WAVE_MONEY
    BANK_TRANSFER
}

enum ProductSaleStatus {
    COMPLETED
    REFUNDED
    VOIDED
}

enum StockMovementType {
    RESTOCK
    SALE
    ADJUSTMENT
    RETURN
}

enum InvoiceStatus {
    DRAFT
    SENT
    PAID
    OVERDUE
    CANCELLED
}

enum StaffRole {
    MANAGER
    RECEPTIONIST
    MAINTENANCE
    CLEANING
    SECURITY
}

enum ShiftStatus {
    SCHEDULED
    IN_PROGRESS
    COMPLETED
    CANCELLED
}

enum NotificationType {
    EMAIL
    SMS
    PUSH
    IN_APP
}

enum NotificationCategory {
    BILLING
    MARKETING
    CLASS_REMINDER
    PT_SESSION
    ACCOUNT_ACTIVITY
    ANNOUNCEMENT
    WORKOUT_PROGRESS
    ATTENDANCE
}

enum MarketingCampaignStatus {
    DRAFT
    SCHEDULED
    SENDING
    SENT
    PARTIAL
    FAILED
    CANCELLED
}

enum CampaignAudienceType {
    ALL_MEMBERS
    INACTIVE_MEMBERS
    BIRTHDAY_MEMBERS
    CLASS_ATTENDEES
    CUSTOM
}

enum CampaignRecipientStatus {
    PENDING
    SENT
    FAILED
    OPENED
    CLICKED
}

enum CampaignEventType {
    DELIVERED
    OPENED
    CLICKED
    FAILED
}

enum MarketingAutomationType {
    BIRTHDAY_WISHES
    REENGAGEMENT
    CLASS_PROMOTION
    NEWSLETTER
}

enum DiscountType {
    PERCENTAGE
    FIXED
}

enum PricingCategory {
    MEMBERSHIP
    CLASS
    MERCHANDISE
}

enum FeatureLevel {
    BASIC
    STANDARD
    PREMIUM
}

enum RetentionRiskLevel {
    LOW
    MEDIUM
    HIGH
}

enum RetentionTaskStatus {
    OPEN
    IN_PROGRESS
    DONE
    DISMISSED
}

enum UserStatus {
    ACTIVE
    INACTIVE
}

enum WaitlistStatus {
    WAITING
    NOTIFIED
    EXPIRED
    BOOKED
    CANCELLED
}

enum PassStatus {
    ACTIVE
    EXPIRED
    CANCELLED
    USED
}

enum ClassPassType {
    BUNDLE
    MONTHLY
}

enum CreditTransactionType {
    PURCHASE
    USAGE
    REFUND
    EXPIRE
}

enum NotificationLogStatus {
    PENDING
    SENT
    FAILED
}
